apiVersion: dope.metacontroller.io/v1
kind: Recipe
metadata:
  name: assert-github-search-neg
  namespace: d-testing
  labels:
    d-testing.dope.metacontroller.io/inference: "true"
spec:
  tasks:
  # Start by applying this HTTP custom resource
  #
  # NOTE:
  #   Once this resource is applied against the Kubernetes
  # cluster, it starts invoking the http request specified
  # in its spec. Resulting output is set against its status.
  - name: apply-github-search-neg
    apply: 
      state: 
        apiVersion: dope.metacontroller.io/v1
        kind: HTTP
        metadata:
          name: github-search-neg
          namespace: d-testing
        spec:
          url: https://github.com/search
          # This method is invalid
          method: GETT
  # Then assert this HTTP resource to have completed
  # successfully
  - name: assert-github-search-neg
    assert: 
      state: 
        apiVersion: dope.metacontroller.io/v1
        kind: HTTP
        metadata:
          name: github-search-neg
          namespace: d-testing
        status:
          # If HTTP resource completes successfully then
          # phase should be set to Completed
          #
          # NOTE:
          #   However, this HTTP resource will not succeed due
          # to invalid http method. Hence, this assertion must
          # fail resulting in failure of this Recipe.
          phase: Online
---